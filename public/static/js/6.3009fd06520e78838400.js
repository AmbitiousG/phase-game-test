webpackJsonp([6],{196:function(e,s,t){"use strict";function a(e){t(322)}Object.defineProperty(s,"__esModule",{value:!0});var n=t(324),i=t(325),o=t(0),r=a,c=o(n.a,i.a,r,"data-v-2c304aec",null);s.default=c.exports},322:function(e,s,t){var a=t(323);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);t(188)("0bd7283e",a,!0)},323:function(e,s,t){s=e.exports=t(187)(!1),s.push([e.i,".wrapper[data-v-2c304aec],form[data-v-2c304aec]{height:100%}.msg-input[data-v-2c304aec]{-webkit-box-sizing:border-box;box-sizing:border-box;width:100%}.name[data-v-2c304aec]{-ms-flex-preferred-size:100px;flex-basis:100px}.type-sys[data-v-2c304aec]{text-align:center;color:#777}",""])},324:function(e,s,t){"use strict";var a=t(34),n=t.n(a),i=t(35),o=(t.n(i),t(326)),r=t.n(o),c=t(14);s.a={name:"Chat",data:function(){return{messages:[],message:"",socket:null}},compuetd:n()({},Object(i.mapGetters)(["user"])),methods:n()({msgClass:function(e){return{"type-sys":this.isSysMsg(e),"type-msg":1==e.type}},isSysMsg:function(e){return 0==e.type||2==e.type},onSubmit:function(e){return e.preventDefault(),""!=this.message&&this.socket.emit("new chat message",this.message),this.message="",!1}},Object(i.mapActions)(["logout"])),created:function(){var e=this,s=Object(c.a)()||"";this.socket&&this.socket.close(),this.socket=r.a.connect({query:"token="+s,transports:["websocket"]}),this.socket.on("error",function(){try{JSON.parse(arguments.length<=0?void 0:arguments[0]).type&&e.$vux.alert.show({title:"请重新登录！",onHide:function(){e.logout(function(){e.$router.push({name:"Login"})})}})}catch(s){e.$vux.toast.show({text:"Error occured!",type:"warn"})}}),this.socket.on("login",function(s){var t=s.user;e.messages.push({type:0,message:t.username+" 登陆!"})}),this.socket.on("logout",function(s){var t=s.user;e.messages.push({type:2,message:t.username+" 退出!"})}),this.socket.on("new chat message",function(s){var t=s.message,a=s.user;e.messages.push({type:1,message:t,user:a}),console.log(t)})}}},325:function(e,s,t){"use strict";var a=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("form",{on:{submit:e.onSubmit}},[t("div",{staticClass:"row column wrapper"},[t("div",{staticClass:"cell basis100"},e._l(e.messages,function(s){return t("div",{staticClass:"row",class:e.msgClass(s)},[e.isSysMsg(s)?e._e():t("div",{staticClass:"cell nogrow name"},[e._v(e._s(s.user.username)+":")]),e._v(" "),t("div",{staticClass:"cell basis100"},[e._v(e._s(s.message))])])})),e._v(" "),t("div",{staticClass:"cell nogrow"},[t("div",{staticClass:"row"},[t("div",{staticClass:"cell basis100"},[t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.message,expression:"message",modifiers:{trim:!0}}],staticClass:"msg-input",attrs:{type:"text"},domProps:{value:e.message},on:{input:function(s){s.target.composing||(e.message=s.target.value.trim())},blur:function(s){e.$forceUpdate()}}})]),e._v(" "),e._m(0)])])])])},n=[function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"cell nogrow"},[t("input",{attrs:{type:"submit",value:"发送"}})])}],i={render:a,staticRenderFns:n};s.a=i}});